#!groovy

node {
   stage('Preparation') { 
      git credentialsId: 'e093579e-dd48-4ec2-a6f5-cd0150ab2eae', url: 'git@github.com:papitoio/nblog-api.git'
      env.RACK_ENV = 'dev'
      bootstrap_ruby()
      bundle()
   }
   stage('Build') {
      env.RACK_ENV = 'dev'
      unit_tests()
   }
   stage('Results') {
      junit 'rspec.xml'
   }
}


def bootstrap_ruby() {
    sh './rbenv.sh'
}

def bundle() {
    sh 'bundle install'
}

def unit_tests() {
    sh 'rspec --format progress --format RspecJunitFormatter --out rspec.xml'
}